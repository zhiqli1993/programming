# Python模块和包

模块和包是Python代码组织和重用的核心机制，允许将相关功能分组并在不同项目中共享。理解模块和包的工作原理对于编写可维护的Python代码至关重要。

## 模块基础

### 什么是模块

模块是包含Python定义和语句的文件。文件名就是模块名加上`.py`后缀。模块中定义的函数、类和变量可以被其他Python程序导入和使用。

### 创建模块

创建模块非常简单，只需编写一个`.py`文件：

```python
# math_utils.py
def add(a, b):
    return a + b

def subtract(a, b):
    return a - b

PI = 3.14159
```

### 导入模块

可以使用`import`语句导入模块：

```python
# 导入整个模块
import math_utils

result = math_utils.add(10, 5)
print(result)  # 15
print(math_utils.PI)  # 3.14159
```

也可以从模块中导入特定的对象：

```python
# 导入特定函数
from math_utils import add, subtract

result = add(10, 5)  # 不需要模块名前缀
print(result)  # 15
```

还可以为导入的模块或对象指定别名：

```python
# 使用别名
import math_utils as mu

result = mu.add(10, 5)
print(result)  # 15

# 导入特定函数并使用别名
from math_utils import add as addition

result = addition(10, 5)
print(result)  # 15
```

### 导入所有内容

可以使用`*`导入模块中的所有内容，但这通常不是最佳实践，因为它可能导致命名冲突：

```python
from math_utils import *

result = add(10, 5)
print(result)  # 15
print(PI)  # 3.14159
```

## 模块搜索路径

当导入模块时，Python在以下位置按顺序查找模块：

1. 当前目录
2. `PYTHONPATH`环境变量指定的目录
3. 标准库目录
4. 第三方包安装目录（如site-packages）

可以查看模块搜索路径：

```python
import sys
print(sys.path)
```

## 包

### 什么是包

包是一种特殊的模块，它包含一个或多个模块文件的目录。包必须包含一个特殊的`__init__.py`文件（在Python 3.3+中，这是可选的，但为了兼容性和明确性，仍然建议使用）。

### 创建包

创建包的步骤：

1. 创建一个目录
2. 在目录中创建`__init__.py`文件
3. 在目录中添加模块文件

例如，创建一个名为`mymath`的包：

```
mymath/
├── __init__.py
├── basic.py
└── advanced.py
```

`__init__.py`可以为空，或者包含初始化代码：

```python
# mymath/__init__.py
print("初始化mymath包")

# 可以在这里导入子模块中的函数，使它们在包级别可用
from .basic import add, subtract
```

在子模块中定义函数：

```python
# mymath/basic.py
def add(a, b):
    return a + b

def subtract(a, b):
    return a - b
```

```python
# mymath/advanced.py
def power(base, exponent):
    return base ** exponent

def factorial(n):
    if n <= 1:
        return 1
    return n * factorial(n - 1)
```

### 导入包

可以通过多种方式导入包中的模块和函数：

```python
# 导入包
import mymath

# 导入包中的特定模块
import mymath.basic
import mymath.advanced

result = mymath.basic.add(10, 5)
print(result)  # 15

# 导入模块并使用别名
import mymath.advanced as adv

result = adv.power(2, 3)
print(result)  # 8

# 从包中的模块导入特定函数
from mymath.basic import add, subtract
from mymath.advanced import power, factorial

result = add(10, 5)
print(result)  # 15
result = factorial(5)
print(result)  # 120
```

如果在`__init__.py`中导入了函数，也可以直接从包中导入这些函数：

```python
# 由于在__init__.py中导入了add和subtract，可以直接从包中导入
from mymath import add, subtract

result = add(10, 5)
print(result)  # 15
```

## 相对导入与绝对导入

在包内的模块之间可以使用相对导入或绝对导入：

### 绝对导入

绝对导入使用完整的包路径：

```python
# mymath/advanced.py
from mymath.basic import add

def calculate_expression(a, b):
    return add(a, b) ** 2
```

### 相对导入

相对导入使用点号（`.`）表示相对路径：

```python
# mymath/advanced.py
from .basic import add  # 从同一个包中导入

def calculate_expression(a, b):
    return add(a, b) ** 2
```

## 命名空间包

Python 3.3引入了命名空间包，它允许包跨越多个目录。命名空间包不需要`__init__.py`文件。这对于大型框架和分布式包很有用。

## `__name__`变量与可执行模块

每个模块都有一个`__name__`变量。当模块被直接执行时，`__name__`被设置为`"__main__"`；当模块被导入时，`__name__`被设置为模块名。

这允许模块同时作为可重用库和独立脚本：

```python
# math_utils.py
def add(a, b):
    return a + b

def subtract(a, b):
    return a - b

if __name__ == "__main__":
    # 当直接运行此文件时执行
    print("直接执行math_utils.py")
    print(f"10 + 5 = {add(10, 5)}")
    print(f"10 - 5 = {subtract(10, 5)}")
```

## 模块和包的最佳实践

1. **组织相关功能**：将相关功能放入同一个模块或包中。
2. **使用明确的导入**：避免使用`from module import *`，而是明确导入需要的对象。
3. **使用`__all__`变量**：在模块中定义`__all__`列表，指定公共API。
4. **使用相对导入**：在包内部使用相对导入，使包更容易重命名或移动。
5. **文档化模块和函数**：为模块、函数和类编写文档字符串。
6. **遵循命名约定**：使用小写字母和下划线命名模块和包。

```python
# 使用__all__限制可导出的名称
__all__ = ['add', 'subtract']

def add(a, b):
    return a + b

def subtract(a, b):
    return a - b

def _internal_function():  # 以下划线开头，表示私有函数
    pass
```

## 标准库和第三方包

Python标准库提供了丰富的模块和包。此外，可以使用pip安装第三方包：

```bash
pip install requests
```

然后在代码中导入：

```python
import requests

response = requests.get('https://api.github.com')
print(response.status_code)
```

## 构建和分发自己的包

可以使用setuptools构建自己的包并上传到PyPI（Python包索引）：

1. 创建以下文件结构：

```
myproject/
├── mypackage/
│   ├── __init__.py
│   └── module.py
├── setup.py
├── README.md
└── LICENSE
```

2. 编写setup.py：

```python
from setuptools import setup, find_packages

setup(
    name="mypackage",
    version="0.1",
    packages=find_packages(),
    install_requires=[
        'requests',
    ],
    author="Your Name",
    author_email="your.email@example.com",
    description="A brief description of the package",
    long_description=open("README.md").read(),
    long_description_content_type="text/markdown",
    url="https://github.com/yourusername/mypackage",
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ],
    python_requires='>=3.6',
)
```

3. 构建和上传包：

```bash
pip install build twine
python -m build
twine upload dist/*
```

模块和包系统是Python的强大特性，使得代码组织、重用和分发变得简单和高效。掌握模块和包的使用对于编写可维护和可扩展的Python代码至关重要。
