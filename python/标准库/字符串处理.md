# Python字符串处理

Python提供了强大的字符串处理功能，包括内置的字符串方法和正则表达式模块。本文档介绍了Python中处理字符串的常用技术和最佳实践。

## 字符串基础

### 字符串创建

Python中的字符串可以用单引号、双引号或三引号创建：

```python
# 单引号和双引号字符串
s1 = 'Hello, World!'
s2 = "Python Programming"

# 三引号字符串（可以跨多行）
s3 = '''This is a
multiline string'''
s4 = """Another
multiline string"""

# 原始字符串（不处理转义字符）
s5 = r'C:\Users\name\documents'  # 反斜杠不会被视为转义字符
```

### 字符串连接

```python
# 使用+运算符
greeting = "Hello" + ", " + "World!"

# 使用join方法（更高效）
words = ["Hello", "World"]
greeting = " ".join(words)

# 使用格式化字符串
name = "Alice"
greeting = f"Hello, {name}!"
```

## 字符串方法

Python的字符串对象提供了丰富的内置方法：

### 大小写转换

```python
text = "Hello, World!"

# 转换为大写
upper_text = text.upper()  # "HELLO, WORLD!"

# 转换为小写
lower_text = text.lower()  # "hello, world!"

# 首字母大写
capitalized = text.capitalize()  # "Hello, world!"

# 每个单词首字母大写
title_case = text.title()  # "Hello, World!"

# 大小写互换
swapped = text.swapcase()  # "hELLO, wORLD!"
```

### 搜索和替换

```python
text = "Python is powerful and Python is easy to learn"

# 检查是否包含子字符串
contains_python = "Python" in text  # True

# 查找子字符串（返回第一个匹配的索引，找不到返回-1）
index = text.find("Python")  # 0
last_index = text.rfind("Python")  # 23

# 计算子字符串出现次数
count = text.count("Python")  # 2

# 替换子字符串
new_text = text.replace("Python", "Java")  # "Java is powerful and Java is easy to learn"
limited_replace = text.replace("Python", "Java", 1)  # "Java is powerful and Python is easy to learn"
```

### 分割和连接

```python
text = "apple,banana,orange,grape"

# 分割字符串
fruits = text.split(",")  # ["apple", "banana", "orange", "grape"]

# 按指定次数分割
first_two = text.split(",", 2)  # ["apple", "banana", "orange,grape"]

# 按行分割
multiline = "Line 1\nLine 2\nLine 3"
lines = multiline.splitlines()  # ["Line 1", "Line 2", "Line 3"]

# 连接字符串
joined = "-".join(fruits)  # "apple-banana-orange-grape"
```

### 去除空白

```python
text = "   Hello, World!   "

# 去除两端空白
trimmed = text.strip()  # "Hello, World!"

# 去除左侧空白
left_trimmed = text.lstrip()  # "Hello, World!   "

# 去除右侧空白
right_trimmed = text.rstrip()  # "   Hello, World!"

# 去除指定字符
custom_trim = "###Hello, World!###".strip("#")  # "Hello, World!"
```

### 检查字符串特性

```python
# 检查是否为字母数字
"Python3".isalnum()  # True
"Python 3".isalnum()  # False (空格不是字母数字)

# 检查是否全是字母
"Python".isalpha()  # True
"Python3".isalpha()  # False

# 检查是否全是数字
"123".isdigit()  # True
"123.45".isdigit()  # False

# 检查是否全是小写
"python".islower()  # True

# 检查是否全是大写
"PYTHON".isupper()  # True

# 检查是否以指定子字符串开头
"Python".startswith("Py")  # True

# 检查是否以指定子字符串结尾
"Python".endswith("on")  # True

# 检查是否只包含空白
"   ".isspace()  # True
```

### 对齐和填充

```python
text = "Python"

# 居中对齐
centered = text.center(10)  # "  Python  "
centered_custom = text.center(10, "-")  # "--Python--"

# 左对齐
left_aligned = text.ljust(10)  # "Python    "
left_custom = text.ljust(10, "-")  # "Python----"

# 右对齐
right_aligned = text.rjust(10)  # "    Python"
right_custom = text.rjust(10, "-")  # "----Python"

# 数字填充
"42".zfill(5)  # "00042"
"-42".zfill(5)  # "-0042"
```

## 字符串格式化

Python提供了多种字符串格式化方法：

### f-strings (Python 3.6+)

f-strings是最现代、最推荐的格式化方式：

```python
name = "Alice"
age = 30
# 基本用法
greeting = f"Hello, {name}! You are {age} years old."

# 表达式计算
result = f"5 + 3 = {5 + 3}"

# 调用方法
result = f"Uppercase name: {name.upper()}"

# 字典访问
person = {"name": "Bob", "age": 25}
greeting = f"Hello, {person['name']}! You are {person['age']} years old."

# 格式化说明符
pi = 3.14159
formatted = f"Pi is approximately {pi:.2f}"  # "Pi is approximately 3.14"

# 对齐
aligned = f"{name:>10}"  # 右对齐，宽度为10
aligned = f"{name:<10}"  # 左对齐，宽度为10
aligned = f"{name:^10}"  # 居中对齐，宽度为10

# 数字格式化
number = 1234.5678
formatted = f"{number:,.2f}"  # "1,234.57"，使用千位分隔符并保留2位小数
```

### str.format() 方法

```python
# 基本用法
greeting = "Hello, {}! You are {} years old.".format(name, age)

# 使用索引
greeting = "Hello, {0}! You are {1} years old. {0} is a nice name.".format(name, age)

# 使用命名参数
greeting = "Hello, {name}! You are {age} years old.".format(name=name, age=age)

# 格式化说明符
pi_str = "Pi is approximately {:.2f}".format(3.14159)  # "Pi is approximately 3.14"
```

### % 格式化运算符（较旧）

```python
# 基本用法
greeting = "Hello, %s! You are %d years old." % (name, age)

# 命名参数
greeting = "Hello, %(name)s! You are %(age)d years old." % {"name": name, "age": age}

# 格式化说明符
pi_str = "Pi is approximately %.2f" % 3.14159  # "Pi is approximately 3.14"
```

## 正则表达式（re模块）

Python的`re`模块提供了强大的正则表达式功能：

### 基本模式匹配

```python
import re

text = "The quick brown fox jumps over the lazy dog"

# 搜索模式（返回第一个匹配）
match = re.search(r"brown", text)
if match:
    print(f"Found: {match.group()} at position {match.start()}")

# 查找所有匹配
matches = re.findall(r"\w+", text)  # 所有单词
print(matches)  # ['The', 'quick', 'brown', 'fox', 'jumps', 'over', 'the', 'lazy', 'dog']

# 迭代匹配
for match in re.finditer(r"\w+", text):
    print(f"Found '{match.group()}' at position {match.start()}-{match.end()}")
```

### 替换

```python
# 基本替换
new_text = re.sub(r"fox", "cat", text)  # "The quick brown cat jumps over the lazy dog"

# 使用函数进行替换
def capitalize_word(match):
    return match.group(0).upper()

upper_words = re.sub(r"\b\w{4,}\b", capitalize_word, text)  # 将4个或更多字母的单词大写
```

### 分割

```python
# 按模式分割
parts = re.split(r"\s+", text)  # 按空白字符分割
print(parts)  # ['The', 'quick', 'brown', 'fox', 'jumps', 'over', 'the', 'lazy', 'dog']

# 限制分割次数
parts = re.split(r"\s+", text, 3)  # 最多分割3次
print(parts)  # ['The', 'quick', 'brown', 'fox jumps over the lazy dog']
```

### 捕获组

```python
text = "John Smith: 555-1234, Mary Johnson: 555-5678"

# 提取名字和电话号码
pattern = r"(\w+ \w+): ([\d-]+)"
matches = re.findall(pattern, text)
print(matches)  # [('John Smith', '555-1234'), ('Mary Johnson', '555-5678')]

# 使用命名捕获组
pattern = r"(?P<name>\w+ \w+): (?P<phone>[\d-]+)"
for match in re.finditer(pattern, text):
    print(f"Name: {match.group('name')}, Phone: {match.group('phone')}")
```

### 常用正则表达式模式

```python
# 电子邮件地址验证
email_pattern = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
is_valid = bool(re.match(email_pattern, "user@example.com"))  # True

# URL验证
url_pattern = r"^(https?|ftp)://[^\s/$.?#].[^\s]*$"
is_valid_url = bool(re.match(url_pattern, "https://www.example.com"))  # True

# 日期格式验证 (YYYY-MM-DD)
date_pattern = r"^\d{4}-\d{2}-\d{2}$"
is_valid_date = bool(re.match(date_pattern, "2023-07-15"))  # True

# 强密码验证（至少8个字符，包含大小写字母、数字和特殊字符）
password_pattern = r"^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
is_strong = bool(re.match(password_pattern, "P@ssw0rd"))  # True
```

### 正则表达式标志

```python
# 忽略大小写
matches = re.findall(r"python", "Python is great, PYTHON is powerful", re.IGNORECASE)
print(matches)  # ['Python', 'PYTHON']

# 多行模式
text = "Line 1\nLine 2\nLine 3"
matches = re.findall(r"^Line", text, re.MULTILINE)  # 匹配每行开头的"Line"
print(matches)  # ['Line', 'Line', 'Line']

# 点号匹配所有字符（包括换行符）
matches = re.findall(r"Line.*3", text, re.DOTALL)
print(matches)  # ['Line 1\nLine 2\nLine 3']

# 组合多个标志
matches = re.findall(r"^line", text, re.MULTILINE | re.IGNORECASE)
print(matches)  # ['Line', 'Line', 'Line']
```

### 正则表达式的性能优化

对于重复使用的正则表达式，应该预编译以提高性能：

```python
# 未编译的模式
for i in range(1000):
    re.search(r"\w+\d+", text)  # 每次都要编译正则表达式

# 预编译模式
pattern = re.compile(r"\w+\d+")
for i in range(1000):
    pattern.search(text)  # 使用编译好的模式
```

## 高级字符串处理

### 字符串编码和解码

```python
# 编码字符串
text = "Hello, 世界"
encoded = text.encode("utf-8")  # 转换为字节对象
print(encoded)  # b'Hello, \xe4\xb8\x96\xe7\x95\x8c'

# 解码字节
decoded = encoded.decode("utf-8")  # 转换回字符串
print(decoded)  # "Hello, 世界"

# 处理编码错误
try:
    b'\xff'.decode('utf-8')  # 这会引发错误
except UnicodeDecodeError:
    print("解码错误")

# 使用错误处理选项
decoded = b'\xff'.decode('utf-8', errors='replace')  # 使用替换字符
print(decoded)  # ""

decoded = b'\xff'.decode('utf-8', errors='ignore')  # 忽略错误字节
print(decoded)  # ""
```

### 文本翻译

```python
# 使用maketrans和translate进行字符替换
text = "Hello, World!"
translation_table = str.maketrans("aeiou", "12345")  # 将元音替换为数字
translated = text.translate(translation_table)
print(translated)  # "H2ll4, W4rld!"

# 删除字符
translation_table = str.maketrans("", "", "aeiou")  # 删除所有元音
translated = text.translate(translation_table)
print(translated)  # "Hll, Wrld!"
```

### 字符串差异比较

```python
import difflib

text1 = "Python is an interpreted language"
text2 = "Python is an interpreted programming language"

# 比较字符串
d = difflib.Differ()
diff = d.compare(text1.splitlines(), text2.splitlines())
print('\n'.join(diff))

# 获取相似度
similarity = difflib.SequenceMatcher(None, text1, text2).ratio()
print(f"相似度: {similarity:.2f}")  # 约0.85
```

### 文本包装

```python
import textwrap

text = "This is a very long string that needs to be wrapped to fit within a certain width without breaking words inappropriately."

# 基本包装
wrapped = textwrap.fill(text, width=30)
print(wrapped)

# 带缩进的包装
indented = textwrap.fill(text, width=30, initial_indent="  ", subsequent_indent="    ")
print(indented)
```

## 字符串处理的最佳实践

1. **使用f-strings进行格式化**：对于Python 3.6+，优先使用f-strings进行字符串格式化，它们更直观、更高效。

2. **使用join而不是+连接字符串**：对于多个字符串的连接，`"".join(strings)`比重复使用`+`运算符更高效。

3. **适当使用正则表达式**：对于复杂的字符串匹配和替换，使用正则表达式；但对于简单的操作，优先使用内置字符串方法。

4. **预编译频繁使用的正则表达式**：使用`re.compile()`预编译正则表达式可以显著提高性能。

5. **考虑国际化和Unicode**：处理文本时，注意编码问题，尤其是处理多语言文本时。

6. **使用strip()去除空白**：在处理用户输入或外部数据时，使用`strip()`去除不必要的空白。

7. **合理分割长字符串**：对于很长的字符串字面量，可以使用多行字符串或字符串连接符`\`分割，提高可读性。

字符串处理是Python编程中的基础技能，熟练掌握这些方法和技巧将大大提高代码的效率和可读性。随着实践的深入，你会发现字符串处理在文本分析、数据清洗、网页抓取等多种场景中的重要应用。
