# Go语言反射机制

## 📚 学习目标
掌握Go语言的反射机制，理解运行时类型操作和动态编程的实现方式。

---

## 1. 反射简介

### 1.1 什么是反射
- 反射是Go语言提供的一种运行时机制，用于检查和操作变量的类型和值。
- 反射主要通过`reflect`包实现。

---

## 2. 基本使用

### 2.1 获取类型和值
```go
package main

import (
    "fmt"
    "reflect"
)

func main() {
    var x int = 42
    t := reflect.TypeOf(x)
    v := reflect.ValueOf(x)

    fmt.Printf("类型: %s, 值: %v\n", t, v)
}
```

### 2.2 修改值
```go
package main

import (
    "fmt"
    "reflect"
)

func main() {
    var x int = 42
    v := reflect.ValueOf(&x).Elem() // 获取指针的元素

    fmt.Printf("原始值: %d\n", x)
    v.SetInt(100) // 修改值
    fmt.Printf("修改后值: %d\n", x)
}
```

---

## 3. 类型操作

### 3.1 检查类型
```go
package main

import (
    "fmt"
    "reflect"
)

func printType(value interface{}) {
    t := reflect.TypeOf(value)
    fmt.Printf("类型: %s, 种类: %s\n", t.Name(), t.Kind())
}

func main() {
    printType(42)
    printType("Hello")
    printType([]int{1, 2, 3})
}
```

### 3.2 动态调用方法
```go
package main

import (
    "fmt"
    "reflect"
)

type Person struct{}

func (p Person) Greet(name string) {
    fmt.Printf("你好, %s!\n", name)
}

func main() {
    p := Person{}
    v := reflect.ValueOf(p)
    method := v.MethodByName("Greet")

    method.Call([]reflect.Value{reflect.ValueOf("张三")})
}
```

---

## 4. 结构体操作

### 4.1 获取字段信息
```go
package main

import (
    "fmt"
    "reflect"
)

type Person struct {
    Name string
    Age  int
}

func main() {
    p := Person{Name: "张三", Age: 25}
    t := reflect.TypeOf(p)

    for i := 0; i < t.NumField(); i++ {
        field := t.Field(i)
        fmt.Printf("字段名: %s, 类型: %s\n", field.Name, field.Type)
    }
}
```

### 4.2 修改字段值
```go
package main

import (
    "fmt"
    "reflect"
)

type Person struct {
    Name string
    Age  int
}

func main() {
    p := Person{Name: "张三", Age: 25}
    v := reflect.ValueOf(&p).Elem()

    v.FieldByName("Age").SetInt(30)
    fmt.Printf("修改后: %+v\n", p)
}
```

---

## 5. 标签操作

### 5.1 获取结构体标签
```go
package main

import (
    "fmt"
    "reflect"
)

type Person struct {
    Name string `json:"name"`
    Age  int    `json:"age"`
}

func main() {
    t := reflect.TypeOf(Person{})
    for i := 0; i < t.NumField(); i++ {
        field := t.Field(i)
        fmt.Printf("字段: %s, 标签: %s\n", field.Name, field.Tag.Get("json"))
    }
}
```

---

## 6. 综合案例：动态JSON解析
```go
package main

import (
    "encoding/json"
    "fmt"
    "reflect"
)

type Person struct {
    Name string `json:"name"`
    Age  int    `json:"age"`
}

func parseJSON(data []byte, obj interface{}) {
    json.Unmarshal(data, obj)

    v := reflect.ValueOf(obj).Elem()
    t := v.Type()

    for i := 0; i < t.NumField(); i++ {
        field := t.Field(i)
        value := v.Field(i)
        fmt.Printf("字段: %s, 值: %v\n", field.Name, value)
    }
}

func main() {
    jsonData := []byte(`{"name": "张三", "age": 25}`)
    var person Person

    parseJSON(jsonData, &person)
}
```

---

## 7. 学习检查点

- [ ] 理解反射的基本概念和使用方式
- [ ] 掌握类型和值的操作
- [ ] 能用反射动态调用方法
- [ ] 能用反射操作结构体字段和标签
- [ ] 能用反射实现动态编程

---

反射机制是Go语言的高级特性，掌握这些基础将为后续的泛型编程和性能优化学习打下坚实基础。
